[package]
name = "subrandr"
version = "0.1.0"
edition = "2021"

[lib]
crate-type = ["rlib", "cdylib", "staticlib"]

[features]
default = ["wgpu"]
wgpu = [
  "dep:wgpu",
  "dep:wasm-bindgen", "dep:wasm-bindgen-futures", "dep:web-sys", "dep:js-sys"
]

[dependencies]
thiserror = "1"
quick-xml = "0.36"

# TODO: Waiting for get_or_try_init to get stabilised.
once_cell = "1"

text-sys = { path = "./text-sys" }
wgpu = { version = "24", optional = true }

icu_segmenter = { version = "1", features = ["compiled_data"] }

[target.'cfg(target_os = "windows")'.dependencies]
windows = { version = "0.61", features = ["Win32_Graphics_DirectWrite"] }
windows-core = "0.61"

[target.'cfg(target_arch = "wasm32")'.dependencies]
wasm-bindgen = { version = "0.2", optional = true }
wasm-bindgen-futures = { version = "0.4", optional = true }
web-sys = { version = "0.3", optional = true }
js-sys = { version = "0.3", optional = true }

[patch.crates-io]
wasm-bindgen-backend = { path = "/home/fishhh/sync/projects2/wasm-bindgen/crates/backend" }
wasm-bindgen-shared = { path = "/home/fishhh/sync/projects2/wasm-bindgen/crates/shared" }
wasm-bindgen-futures = { path = "/home/fishhh/sync/projects2/wasm-bindgen/crates/futures" }
wasm-bindgen = { path = "/home/fishhh/sync/projects2/wasm-bindgen" }
js-sys = { path = "/home/fishhh/sync/projects2/wasm-bindgen/crates/js-sys" }

[profile.release]
panic = "abort"

[profile.profiling]
inherits = "release"
strip = false
debug = true

[workspace]
members = [
  "sbr-overlay",
  "xtask"
]
